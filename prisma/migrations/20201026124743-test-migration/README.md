# Migration `20201026124743-test-migration`

This migration has been generated by joswambugu at 10/26/2020, 3:47:44 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"id" SERIAL,
"username" text   NOT NULL ,
"email" text   NOT NULL ,
"password" text   NOT NULL ,
"booked" boolean   NOT NULL DEFAULT false,
"role" "Role"  NOT NULL DEFAULT E'PASSENGER',
"busId" integer   ,
"addressId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Address" (
"id" SERIAL,
"county" text   NOT NULL ,
"city" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Bus" (
"id" SERIAL,
"plates" text   NOT NULL ,
"routes" text   NOT NULL ,
"price" integer   NOT NULL ,
"departureTime" timestamp(3)   NOT NULL ,
"arrivalTime" timestamp(3)   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Transaction" (
"id" SERIAL,
"cart" text   NOT NULL ,
"status" text   NOT NULL ,
"amount" integer   NOT NULL ,
"userId" integer   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL ,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "User_addressId_unique" ON "public"."User"("addressId")

CREATE UNIQUE INDEX "Bus.plates_unique" ON "public"."Bus"("plates")

CREATE UNIQUE INDEX "Transaction.cart_unique" ON "public"."Transaction"("cart")

CREATE UNIQUE INDEX "Transaction.userId_unique" ON "public"."Transaction"("userId")

ALTER TABLE "public"."User" ADD FOREIGN KEY ("addressId")REFERENCES "public"."Address"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("busId")REFERENCES "public"."Bus"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Transaction" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201026124743-test-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,68 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User{
+id              Int        @id @default(autoincrement())
+username        String
+email           String     @unique
+password        String
+booked          Boolean    @default(false)
+role            Role       @default(PASSENGER)
+address         Address   @relation(fields: [addressId],references:[id])
+busBooked       Bus ?       @relation(fields: [busId],references:[id])
+transactions    Transaction[]
+busId           Int?
+addressId       Int
+createdAt       DateTime   @default(now())
+updatedAt       DateTime   @updatedAt  
+
+}
+
+model Address{
+id           Int         @id @default(autoincrement())  
+county       String
+city         String
+user         User        
+createdAt    DateTime     @default(now())
+updatedAt    DateTime      @updatedAt  
+
+
+}
+model Bus{
+id              Int        @id @default(autoincrement())
+plates          String     @unique
+routes          String  
+price           Int   
+departureTime   DateTime   
+arrivalTime     DateTime 
+passengers      User[]
+createdAt       DateTime   @default(now())
+updatedAt       DateTime   @updatedAt  
+
+}
+model Transaction{
+id             Int     @id @default(autoincrement())
+cart           String      @unique
+status         String
+amount         Int
+user           User      @relation(fields: [userId],references:[id])
+userId         Int        @unique
+createdAt       DateTime 
+updatedAt       DateTime
+
+
+
+}
+enum Role{
+  PASSENGER
+  DRIVER
+}
```


